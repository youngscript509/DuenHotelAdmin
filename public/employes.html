<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion des Employés</title>
     <!-- Bootstrap CSS -->
     <link rel="stylesheet" href="assets/vendor/bootstrap/css/bootstrap.min.css">
     <link href="assets/vendor/fonts/circular-std/style.css" rel="stylesheet">
     <link rel="stylesheet" href="assets/libs/css/style.css">
     <link rel="stylesheet" href="assets/vendor/fonts/fontawesome/css/fontawesome-all.css">
 <style>
    body {
    font-family: Arial, sans-serif;
}

form {
    margin-bottom: 20px;
}

form label {
    display: block;
    margin-top: 10px;
}

form input {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
}

form button {
    margin-top: 20px;
    padding: 10px 15px;
    background-color: #4CAF50;
    color: white;
    border: none;
    cursor: pointer;
}

form button:hover {
    background-color: #45a049;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}

table, th, td {
    border: 1px solid black;
}

th, td {
    padding: 8px;
    text-align: left;
}

 </style>
</head>
<body class="container">
    <div class="card">
    <h1>Gestion des Employés</h1>
    
    <form id="employeeForm" style="margin-right: 20px; margin-left: 20px;" >
        <label for="nomcomplet"  class="form-control form-control-lg" >Nom Complet:</label>
        <input  class="form-control form-control-lg"  type="text" id="nomcomplet" name="nomcomplet" required><br>
        
        <label for="id"  class="form-control form-control-lg" >ID:</label>
        <input  class="form-control form-control-lg"  type="text" id="id" name="id" required><br>
        
        <label  class="form-control form-control-lg"  for="adresse">Adresse:</label>
        <input  class="form-control form-control-lg"  type="text" id="adresse" name="adresse" required><br>
        
        <label  class="form-control form-control-lg"  for="phone">Téléphone:</label>
        <input  class="form-control form-control-lg"  type="text" id="phone" name="phone" required><br>
        
        <label  class="form-control form-control-lg"  for="fonction">Fonction:</label>
        <input  class="form-control form-control-lg"  type="text" id="fonction" name="fonction" required><br>
        
        <label  class="form-control form-control-lg"  for="salaire">Salaire:</label>
        <input  class="form-control form-control-lg"  type="text" id="salaire" name="salaire" required><br>
        
        <label  class="form-control form-control-lg"  for="contact">Personne de Contact:</label>
        <input  class="form-control form-control-lg"  type="text" id="contact" name="contact" required><br>
        
        <label  class="form-control form-control-lg"  for="phone_contact">Téléphone de Contact:</label>
        <input  class="form-control form-control-lg"  type="text" id="phone_contact" name="phone_contact" required><br>
        
        <label  class="form-control form-control-lg"  for="alergie">Allergie:</label>
        <input  class="form-control form-control-lg"  type="text" id="alergie" name="alergie"><br>
        
        <label  class="form-control form-control-lg"  for="maladie">Maladie:</label>
        <input  class="form-control form-control-lg"  type="text" id="maladie" name="maladie"><br>
        
        <button type="submit">Enregistrer</button>
    </form>
    
    
    <h2>Liste des Employés</h2>
    <table id="employeeTable">
        <thead>
            <tr>
                <th>Nom Complet</th>
                <th>ID</th>
                <th>Adresse</th>
                <th>Téléphone</th>
                <th>Fonction</th>
                <th>Salaire</th>
                <th>Personne de Contact</th>
                <th>Téléphone de Contact</th>
                <th>Allergie</th>
                <th>Maladie</th>
                <th>Actions</th> <!-- New Actions Column -->
            </tr>
        </thead>
        <tbody></tbody>
    </table>
    
</div>
<script src="https://konbitmarket.netlify.app/js/js/firebase-app.js"></script>
<script src="https://konbitmarket.netlify.app/js/js/auth.js"></script>
<script src="https://konbitmarket.netlify.app/js/js/firebase-firestore.js"></script>
<script src="firebase-config.js"></script>

<script>


// Référence au formulaire et au tableau
const employeeForm = document.getElementById('employeeForm');
const employeeTableBody = document.querySelector('#employeeTable tbody');
let editingEmployeeId = null;

// Fonction pour ajouter ou mettre à jour un employé dans la base de données et le tableau
employeeForm.addEventListener('submit', (e) => {
    e.preventDefault();

    const employee = {
        nomcomplet: employeeForm.nomcomplet.value,
        id: employeeForm.id.value,
        adresse: employeeForm.adresse.value,
        phone: employeeForm.phone.value,
        fonction: employeeForm.fonction.value,
        salaire: employeeForm.salaire.value,
        contact: employeeForm.contact.value,
        phone_contact: employeeForm.phone_contact.value,
        alergie: employeeForm.alergie.value,
        maladie: employeeForm.maladie.value,
    };

    if (editingEmployeeId) {
        db.collection('employes').doc(editingEmployeeId).update(employee).then(() => {
            console.log('Employé mis à jour !');
            employeeForm.reset();
            editingEmployeeId = null;
            loadEmployees();
        }).catch((error) => {
            console.error('Erreur lors de la mise à jour de l\'employé : ', error);
        });
    } else {
        db.collection('employes').add(employee).then(() => {
            console.log('Employé ajouté !');
            employeeForm.reset();
            loadEmployees();
        }).catch((error) => {
            console.error('Erreur lors de l\'ajout de l\'employé : ', error);
        });
    }
});

// Fonction pour charger et afficher les employés
function loadEmployees() {
    db.collection('employes').get().then((querySnapshot) => {
        employeeTableBody.innerHTML = '';
        querySnapshot.forEach((doc) => {
            const employee = doc.data();
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${employee.nomcomplet}</td>
                <td>${employee.id}</td>
                <td>${employee.adresse}</td>
                <td>${employee.phone}</td>
                <td>${employee.fonction}</td>
                <td>${employee.salaire}</td>
                <td>${employee.contact}</td>
                <td>${employee.phone_contact}</td>
                <td>${employee.alergie}</td>
                <td>${employee.maladie}</td>
                <td class="action-buttons">
                    <button class="edit" onclick="editEmployee('${doc.id}')">Éditer</button>
                    <button class="delete" onclick="deleteEmployee('${doc.id}')">Supprimer</button>
                </td>
            `;
            employeeTableBody.appendChild(row);
        });
    });
}

// Fonction pour éditer un employé
function editEmployee(employeeId) {
    db.collection('employes').doc(employeeId).get().then((doc) => {
        const employee = doc.data();
        employeeForm.nomcomplet.value = employee.nomcomplet;
        employeeForm.id.value = employee.id;
        employeeForm.adresse.value = employee.adresse;
        employeeForm.phone.value = employee.phone;
        employeeForm.fonction.value = employee.fonction;
        employeeForm.salaire.value = employee.salaire;
        employeeForm.contact.value = employee.contact;
        employeeForm.phone_contact.value = employee.phone_contact;
        employeeForm.alergie.value = employee.alergie;
        employeeForm.maladie.value = employee.maladie;
        editingEmployeeId = employeeId;
    }).catch((error) => {
        console.error('Erreur lors de l\'édition de l\'employé : ', error);
    });
}

// Fonction pour supprimer un employé
function deleteEmployee(employeeId) {
    db.collection('employes').doc(employeeId).delete().then(() => {
        console.log('Employé supprimé !');
        loadEmployees();
    }).catch((error) => {
        console.error('Erreur lors de la suppression de l\'employé : ', error);
    });
}

// Charger les employés au chargement de la page
window.onload = loadEmployees;

</script>
</body>
</html>
