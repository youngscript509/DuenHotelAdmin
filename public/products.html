<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="assets/vendor/bootstrap/css/bootstrap.min.css">
    <link href="assets/vendor/fonts/circular-std/style.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/libs/css/style.css">
    <link rel="stylesheet" href="assets/vendor/fonts/fontawesome/css/fontawesome-all.css">
    <link rel="stylesheet" href="assets/vendor/vector-map/jqvmap.css">
    <link href="assets/vendor/jvectormap/jquery-jvectormap-2.0.2.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/vendor/charts/chartist-bundle/chartist.css">
    <link rel="stylesheet" href="assets/vendor/charts/c3charts/c3.css">
    <link rel="stylesheet" href="assets/vendor/charts/morris-bundle/morris.css">
    <link rel="stylesheet" type="text/css" href="assets/vendor/daterangepicker/daterangepicker.css" />
    <link rel="icon" href="hotel.png" type="image/png">
    <title>Duen-Hotel -Finance</title>
</head>

<body>
   
    <!-- ============================================================== -->
    <div class="dashboard-main-wrapper">
        <!-- ============================================================== -->
     <!-- main wrapper -->
    <!-- ============================================================== -->
    <div class="dashboard-main-wrapper">
        <!-- ============================================================== -->
        <!-- navbar -->
        <!-- ============================================================== -->
        <div class="dashboard-header">
            <nav class="navbar navbar-expand-lg bg-white fixed-top">
                <a class="navbar-brand" href="index.html">DUEN-HOTEL</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                              
            </nav>
        </div>
        <style>
            center{
                width: 100%;
            }
            center button{
                color: rgb(15, 61, 228);
                width: 150px;
                border: none;
                background-color: aliceblue;
                margin-inline: 10px;
                height: 40px;
                font-size: 20px;
                margin-bottom: 15px;

            }
            #product{
                background-color: aqua;
            }
            .details{
                width: 100%;
                height: 800px;
                background-color: aliceblue;
                top: 0;
                bottom: 0;
                z-index: 40000;
                position: fixed;
                display: none;
            }
            #close{
                top: 5px;
                background-color: rgb(50, 50, 237);
                color: aliceblue;
            }
        </style>

<center class="pages">
  <button id="home" onclick=" window.location.href = 'index.html';">D-Food</button>
  <button id="rooms" onclick=" window.location.href = 'rooms.html';">Rooms</button> 
  <button id="repport" onclick=" window.location.href = 'repportgeneral.html';">Repports</button> 
  <button id="product" onclick=" window.location.href = 'products.html';">Products</button>
  <button id="expences" onclick=" window.location.href = 'expences.html';">Expences</button>
  <button id="unpaid" onclick=" window.location.href = 'expencesus.html';">ExpenceUs</button> 

</center>
       
        <div class="dashboard-wrapper">
            <div class="dashboard-finance">
                <div class="container-fluid dashboard-content">
                    <!-- ============================================================== -->
                    <!-- pageheader  -->
                    <!-- ============================================================== -->
                    <div class="row">
                        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                            <div class="page-header">
                                <h3 class="mb-2">Finance Dashboard </h3>
                                <p class="pageheader-text">Proin placerat ante duiullam scelerisque a velit ac porta, fusce sit amet vestibulum mi. Morbi lobortis pulvinar quam.</p>
                                <div class="page-breadcrumb">
                                    <nav aria-label="breadcrumb">
                                        <ol class="breadcrumb">
                                            <li class="breadcrumb-item"><a href="#" class="breadcrumb-link">Dashboard</a></li>
                                            <li class="breadcrumb-item active" aria-current="page">Finance Dashboard Duen</li>
                                        </ol>
                                    </nav>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ============================================================== -->
                    <!-- end pageheader  -->
                    <!-- ============================================================== -->
                    <div class="row">
                        <div class="offset-xl-10 col-xl-2 col-lg-2 col-md-6 col-sm-12 col-12">
                            <form>
                                <div class="form-group">
                                  <label for="datefrom">From</label>
                                    <input class="form-control" type="date" id="datefrom" name="daterange" value="2024-02-15" />
                                    <label for="dateto">To</label>
                                    <input class="form-control" type="date" id="dateto" name="daterange" />
                                </div>
                            </form>
                        </div>
                    </div>
                   
                    <div class="row" style="width: 100%;">
                        
                       
                        <div style="width: 100%;">
                            <div class="card" style="width: 100%;">
                                <h5 class="card-header">Repport Total</h5>
                                <div class="card-body">
                                    <div class="metric-value d-inline-block">
                                        <div id="resultsContainer"> 
                                            <h3>Repports on products</h3>
                                            <ul id="productList"></ul>
                                           


                                           
                                        </div>
                                    </div>
                                    <div class="metric-label d-inline-block float-right text-success font-weight-bold">
                                        <span class="icon-circle-small icon-box-xs text-success bg-success-light"><i class="fa fa-fw fa-arrow-up"></i></span><span class="ml-1">25%</span>
                                    </div>
                                </div>
                                <div class="card-body bg-light p-t-40 p-b-40">
                                    <div id="sparkline-revenue3"></div>
                                </div>
                                <div class="card-footer text-center bg-white">
                                    <a href="#" class="card-link">View Details</a>
                                </div>
                            </div>
                        </div>
                    
                    </div>

                    <!-- Structure HTML pour afficher les données -->
                    <script src="https://konbitmarket.netlify.app/js/js/firebase-app.js"></script>
                    <script src="https://konbitmarket.netlify.app/js/js/auth.js"></script>
                    <script src="https://konbitmarket.netlify.app/js/js/firebase-firestore.js"></script>
                    <script src="firebase-config.js"></script>

           

<script>
async function updateProducts() {
    const dateFrom = document.getElementById('datefrom').value;
    const dateTo = document.getElementById('dateto').value;

    // Convertir les valeurs de chaîne en objets Date
    const fromDate = new Date(dateFrom);
    const toDate = new Date(dateTo);

    const productsMap = new Map(); // Utilisation d'une Map pour stocker les produits par item avec leur prix

    try {
        const collections = ['sales', 'salesFoodDuen', 'salesfood', 'salesreservgdes', 'salesreservgdespool', 'salesfoodAmericain', 'salesreservus', 'salesAmericain', 'salesreservuspool'];

        for (const collectionName of collections) {
            const collectionRef = db.collection(collectionName);

            // Filtrer les documents par période de date
            const querySnapshot = await collectionRef.where("date", ">=", fromDate.toISOString()).where("date", "<=", toDate.toISOString()).get();

            querySnapshot.forEach(doc => {
                const products = doc.data().products;

                if (Array.isArray(products)) {
                    products.forEach(product => {
                        const { item, quantity, price } = product;
                        const revenue = quantity * price;

                        // Ajouter la quantité et le prix existants à la quantité et au prix actuels
                        if (productsMap.has(item)) {
                            const existingProduct = productsMap.get(item);
                            existingProduct.quantity += parseInt(quantity);
                            existingProduct.revenue += revenue;
                        } else {
                            // Initialiser la quantité et le prix si elle n'existe pas encore
                            productsMap.set(item, { quantity: parseInt(quantity), price: price, revenue: revenue });
                        }
                    });
                }
            });
        }

        // Afficher les quantités, les prix et les revenus par item dans la liste
        const productList = document.getElementById('productList');
        productList.innerHTML = ''; // Effacer la liste précédente

        productsMap.forEach((product, item) => {
            const listItem = document.createElement('li');
            listItem.textContent = `${item}: Quantité - ${product.quantity}, Prix - ${product.price}, Revenu - ${product.revenue}`;
            productList.appendChild(listItem);
        });
    } catch (error) {
        console.error('Erreur lors de la mise à jour des produits :', error);
    }
}

  
      </script>
           



  



<!-- ============================================================== -->
                    <!-- end revenue year  -->
                  
            <!-- ============================================================== -->
            <!-- footer -->
            <!-- ============================================================== -->
            <div class="footer">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 col-12">
                            Copyright © 2018 Concept. All rights reserved. Dashboard by <a href="#">Wedser Charl&eacute;</a>. 
                        </div>
                        <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 col-12">
                            <div class="text-md-right footer-links d-none d-sm-block">
                                <a href="javascript: void(0);">About</a>
                                <a href="javascript: void(0);">Support</a>
                                <a href="javascript: void(0);">Contact Us</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- ============================================================== -->
            <!-- end footer -->
            <!-- ============================================================== -->
        </div>
        <!-- ============================================================== -->
        <!-- end wrapper  -->
        <!-- ============================================================== -->
    </div>
    <!-- ============================================================== -->
    <!-- end main wrapper  -->
    <!-- ============================================================== -->

   
</body>
</html>
